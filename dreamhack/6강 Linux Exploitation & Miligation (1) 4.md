# NX bit
* NX bit(No-eXecute bit) : 프로그램의 공격을 어렵게 하기 위해, 메모리에 쓰기 권한과 실행 권한을 동시에 부여하지 않는 것.
* 예시
``` C
//gcc -o example2_x example2.c -fno-stack-protector -z execstack -mpreferred-stack-boundary=2 -m32
//NX bit가 적용되어 있는 컴파일
//gcc -o example2_nx example2.c -fno-stack-protector -mpreferred-stack-boundary=2 -m32
//NX bit가 적용되어 있지 않은 컴파일
#include <stdio.h>
unsigned char code[] = \
"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\x31\xd2\xb0\x0b\xcd\x80";
int main(void){
  void (*shellcode)() = (void(*)())code;
  
  printf("Executing shellcode\n");
  shellcode();
}
```
  * NX bit가 적용되지 않은 example2_x의 메모리 맵
  ```
  $ gdb -q ./example2_x
  Reading symbols from ./example2_x...(no debugging symbols found)...done.
  (gdb) b main
  Breakpoint 1 at 0x8048411
  (gdb) r
  Starting program: ~/example2_x 
  Breakpoint 1, 0x08048411 in main ()
  (gdb) shell cat /proc/`pidof example2_x`/maps
  08048000-08049000 r-xp 00000000 08:01 147398                             ~/example2_x
  08049000-0804a000 r-xp 00000000 08:01 147398                             ~/example2_x
  0804a000-0804b000 rwxp 00001000 08:01 147398                             ~/example2_x 
  …
  fffdd000-ffffe000 rwxp 00000000 00:00 0                                  [stack]
  (gdb) 
  ```
  
  스택과 데이터 영역 모두 rwx, 즉 읽기, 쓰기, 실행 권한을 가지고 있따.
  example2_x 바이너리를 실행했을 때 정상적으로 셸코드가 실행되어 셸이 실행된다.
  ```
  $ ./example2_x
  Executing shellcode
  $ id
  uid=1001(theori) gid=1001(theori) groups=1001(theori) 
  ```
  * NX bit가 적용된 example2_nx의 메모리 맵
  ```
  $ gdb -q ./example2_nx
  Reading symbols from ./example2_nx...(no debugging symbols found)...done.
  (gdb) b main
  Breakpoint 1 at 0x8048411
  (gdb) r
  Starting program: ~/example2_nx 
  Breakpoint 1, 0x08048411 in main ()
  (gdb) shell cat /proc/`pidof example2_nx`/maps
  08048000-08049000 r-xp 00000000 08:01 147400                             ~/example2_nx
  08049000-0804a000 r--p 00000000 08:01 147400                             ~/example2_nx
  0804a000-0804b000 rw-p 00001000 08:01 147400                             ~/example2_nx
  …
  fffdd000-ffffe000 rw-p 00000000 00:00 0                                  [stack]
  (gdb) 
  ```
  스택과 데이터 영역 모두 rw, 즉 읽기, 쓰기 권한만 가지고 있다.
  example2_nx 바이너리를 실행했을 때는 데이터 영역에 실행권한이 없기 때문에 Segmentation Fault가 발생한 다.
  ```
  $ ./example2_nx
  Executing shellcode
  [1]    104735 segmentation fault (core dumped)  ./example2_nx
  $
  ```
  



















